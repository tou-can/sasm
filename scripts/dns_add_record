#!/bin/bash

if [ "$(id -u)" != "0" ]; then
    echo "This script must be run as root."
    exit 1
fi

if [ "$#" -lt 3 ]; then
    echo "Usage: sudo dns_add_record -t <type> <name> <data> <zone>"
    exit 1
fi

RECORD_TYPE="A"
if [ "$1" == "-t" ]; then
    RECORD_TYPE=$2
    shift 2
fi

NAME=$1
DATA=$2
ZONE=$3
ZONE_FILE="/etc/bind/zones/$ZONE"

echo "ZONE: $ZONE"
echo "NAME: $NAME"
echo "DATA: $DATA"
echo "Constructed ZONE_FILE path: $ZONE_FILE"

if [ ! -f "$ZONE_FILE" ]; then
    echo "Zone file $ZONE_FILE not found!"
    exit 1
fi

echo "Adding $RECORD_TYPE record for $NAME.$ZONE..."

case $RECORD_TYPE in
    A)
        echo "$NAME    IN    A    $DATA" >> $ZONE_FILE
        ;;
    CNAME)
        echo "$NAME    IN    CNAME    $DATA" >> $ZONE_FILE
        ;;
    MX)
        echo "$NAME    IN    MX    10    $DATA" >> $ZONE_FILE
        echo "$NAME    IN    A    $DATA" >> $ZONE_FILE
        ;;
    *)
        echo "Unsupported record type: $RECORD_TYPE"
        exit 1
        ;;
esac

# Reload bind to apply changes
sudo systemctl reload bind9

echo "$RECORD_TYPE record added to $ZONE successfully."
